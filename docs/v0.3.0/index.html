<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>libevfibers: About libevfibers</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-35569049-1']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">libevfibers
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">About libevfibers </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="intro_sec"></a>
Introduction</h1>
<p>libevfibers is a small C fiber library that uses libev based event loop and libcoro based coroutine context switching. As libcoro alone is barely enough to do something useful, this project aims at building a complete fiber API around it while leveraging libev's high performance and flexibility.</p>
<p>You may ask why yet another fiber library, there are GNU Pth, State threads, etc. When I was looking at their API, I found it being too restrictive: you cannot use other event loop. For GNU Pth it's solely select based implementation, as for state threads &mdash; they provide several implementations including poll, epoll, select though event loop is hidden underneath the public API and is not usable directly. I found another approach more sensible, namely: just put fiber layer on top of well-known and robust event loop implementation. Marc Lehmann already provided all the necessary to do the job: event loop library libev with coroutine library libcoro.</p>
<p>So what's so cool about fibers? Fibers are user-space threads. User-space means that context switching from one fiber to an other fiber takes no effort from the kernel. There are different ways to achieve this, but it's not relevant here since libcoro already does all the dirty job. At top level you have a set of functions that execute on private stacks that do not intersect. Whenever such function is going to do some blocking operation, i.e. socket read, it calls fiber library wrapper, that asks event loop to transfer execution to this function whenever some data arrives, then it yields execution to other fiber. From the function's point of view it runs in exclusive mode and blocks on all operations, but really other such functions execute while this one is waiting. Typically most of them are waiting for something and event loop dispatches the events.</p>
<p>This approach helps a lot. Imagine that you have some function that requires 3 events. In classic asynchronous model you will have to arrange your function in 3 callbacks and register them in the event loop. On the other hand having one function waiting for 3 events in ``blocking'' fashion is both more readable and maintainable.</p>
<p>Then why use event loop when you have fancy callback-less fiber wrappers? Sometimes you just need a function that will set a flag in some object when a timer times out. Creating a fiber solely for this simple task is a bit awkward.</p>
<p>libevfibers allows you to use fiber style wrappers for blocking operations as well as fall back to usual event loop style programming when you need it.</p>
<h1><a class="anchor" id="install_sec"></a>
Installation</h1>
<h2><a class="anchor" id="requirements_ssec"></a>
Requirements</h2>
<p>To build this documentation properly you need to have <a href="http://www.stack.nl/~dimitri/doxygen">doxygen</a> version &gt;= 1.8 since it used markdown.</p>
<p>To build libevfibers you need the following packages:</p>
<ul>
<li><p class="startli"><a href="http://www.cmake.org">cmake</a></p>
<p class="startli">CMake is a build system used to assemble this project.</p>
</li>
<li><p class="startli"><a href="http://software.schmorp.de/pkg/libev.html">libev</a> development files</p>
<p class="startli">Well-known and robust event loop.</p>
</li>
<li><p class="startli"><a href="http://vrb.slashusr.org">VRB</a> development files</p>
<p class="startli">Virtual ring buffer library, used as underlying data structure in <a class="el" href="structfbr__buffer.html" title="Inter-fiber communication pipe.">fbr_buffer</a>.</p>
</li>
<li><p class="startli"><a href="http://valgrind.org">valgrind</a> development files</p>
<p class="startli">libevfibers makes use of client requests in valgrind to register stacks.</p>
</li>
<li><p class="startli"><a href="http://check.sourceforge.net">Check</a> unit testing framework</p>
<p class="startli">Strictly it's not a requirement, but you better run unit tests before installation.</p>
</li>
</ul>
<p>You don't need libcoro installed as it's part of source tree and will build along with libevfibers.</p>
<p>As far as runtime dependencies concerned, the following is required:</p>
<ul>
<li><a href="http://software.schmorp.de/pkg/libev.html">libev</a> runtime files</li>
<li><a href="http://vrb.slashusr.org">VRB</a> runtime files</li>
</ul>
<p>For debian-based distributions users (i.e. Ubuntu) you can use the following command to install all the dependencies:</p>
<div class="fragment"><div class="line">sudo apt-<span class="keyword">get</span> install cmake libev-dev libvrb0-dev valgrind check</div>
</div><!-- fragment --><h2><a class="anchor" id="building_ssec"></a>
Building</h2>
<p>Once you have all required packages installed you may proceed with building. Roughly it's done as follows:</p>
<div class="fragment"><div class="line">git clone https:<span class="comment">//code.google.com/p/libevfibers</span></div>
<div class="line">cd libevfibers/</div>
<div class="line">mkdir build</div>
<div class="line">cd build/</div>
<div class="line">cmake -DCMAKE_BUILD_TYPE=RelWithDebInfo ..</div>
<div class="line">make</div>
<div class="line">sudo make install</div>
</div><!-- fragment --> <h2><a class="anchor" id="building_deb_ssec"></a>
Building debian package</h2>
<p>If you are running debian-based distribution, it will be more useful to build a debian package and install it.</p>
<p>The following actions will bring you there: </p>
<div class="fragment"><div class="line">git clone https:<span class="comment">//code.google.com/p/libevfibers</span></div>
<div class="line">cd libevfibers/</div>
<div class="line">dpkg-buildpackage</div>
<div class="line">sudo dpkg -i ../libevfibers?_*_*.deb ../libevfibers-dev_*_*.deb</div>
</div><!-- fragment --><h1><a class="anchor" id="contributors_sec"></a>
Contributors</h1>
<p>libevfibers was written and designed by Konstantin Olkhovskiy.</p>
<p>Sergey Myasnikov contributed some patches, a lot of criticism and ideas. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sun May 12 2013 13:39:55 for libevfibers by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.1.2 </li>
  </ul>
</div>
</body>
</html>
